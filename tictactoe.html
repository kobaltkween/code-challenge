
<!DOCTYPE html>
<!--
   Here is my response to your coding challenge.  
   Thanks so much for the opportunity.  
   I decided to make this in just HTML/CSS/JS, because it seemed like 
   a purely client side problem.  
   
   I see you support IE going pretty far back on Rare.us.  Which makes 
   sense for such a high traffic site.  I figure that fits your traffic 
   data. But since 
			* IE is now only supported in the latest version for the platform
			* Windows 7 and higher are the bulk of Windows OS's
			* Firefox and Chrome both push updates pretty regularly and heavily
			* Apple seems to do the same with Safari
			
	I'm going to stick with IE10+ and modern browser solutions for this 
	limited audience.
-->
<html>
	<head>
		<meta charset="utf-8">
		<title>Tic Tac Toe Coding Challenge</title>
		<link href="https://fonts.googleapis.com/css?family=Lora:400,400italic" rel="stylesheet" type="text/css">
		<link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,400italic,600,600italic' rel="stylesheet" type="text/css">
		<style>
			* {
					box-sizing: border-box;
				}
			html {
				background-color: #f4f4f4;
			}
			body {
				background-color: white;
				color: black;
				margin: 0 auto;
				max-width: 840px;
				min-width: 420px;
				width: 75%;
				border-left: 1px solid #ddd;
				border-right: 1px solid #ddd;
				box-shadow:0 0 25px #ddd;
				min-height: 100vh;
				padding: 10px;
			}
			body, p, ul, ol, td {
				font-family: "Source Sans Pro", Helvetica, Arial, sans-serif;
				margin-top: 0;
				padding-top: 0;
			}
			h1, h2, h3 {
				font-family: Lora, Georgia, Times, serif;
				font-weight:  normal;
				margin-top: 0;
			}
			h1 {
				font-size: 48px;
				text-align: center;
				margin-bottom: 25px;
				padding-top: 15px;
			}
			table {
				border-collapse: collapse;
			}
			#board, #instructions {
				position: relative;
				float: left;
				margin: 1%;
				padding: 1%;
				width: 48%;
				min-width: 380px;
			}
			#board table {
				height: 300px;
				width: 300px;
				margin: 20px;
			}
			#board table td {
				-webkit-transition: color 0.25s, background-color 0.25s;
				transition: color 0.25s, background-color 0.25s;
				height: 100px;
				width: 100px;
				text-align: center;
				vertical-align: center;
				font-size: 48px;
				font-family: Lora, Georgia, Times, serif;
			}
			#board table tr#row2 {
				border-top: 1px solid #444;
				border-bottom: 1px solid #444;
			}
			#board table tr td:nth-child(2){
				border-right: 1px solid #444;
				border-left: 1px solid #444;
			}
			.mark {
				font-size: 30px;
				padding: 10px;
				font-family: Lora, Georgia, Times, serif;
				font-weight: 600;
				vertical-align: middle;
				cursor: pointer;
				display: inline-block;
			}
			.mark:focus, #board table tr td:focus {
				background-color: #eee;
			}
			.warning {
				font-size: 20px;
				font-weight: 600;
			}
			.right {
				text-align: right;
			}
			a#reset {
				-webkit-transition: all 0.5s ease;
				transition: all 0.5s ease;
				border: 1px solid #ddd;
				background-color: #eee;
				box-shadow: 
					inset 0 0 8px #fff,
					inset 0 0 1px #fff,
					0 0 2px #ddd;
				padding: 10px 20px;
				border-radius: 50vh;
				font-size: 20px;
				display: none;
			}
			a#reset:hover, a#reset:focus {
				box-shadow: 
					inset 0 0 15px #fff,
					inset 0 0 4px #fff,
					0 0 16px #eee,
					0 2px 4px #888;
				cursor: pointer;
				outline: 0;
				text-decoration: underline dotted black;
			}
			a#reset:active {
				box-shadow: 
					inset 0 0 20px #fff,
					inset 0 0 4px #fff,
					0 0 1px #ddd;
				text-decoration-color: white;
			}
			p#chosen {
				display: none;
			}
			#board p.warning, #board p.message {
				font-size: 20px;
				color: white;
				padding: 10px;
				border-radius: 10px;
				margin-top: 30px;
			}
			#board p.warning {
				background-color: orange;
			}
			footer {
				clear: both;
				text-align: center;
				margin-top: 30px;
				padding: 10px;
				font-size: 0.85em;
				font-style: italic;
			}
		</style>
	</head>

	<body>
		<header>
			<h1>TicTacToe Coding Challenge</h1>
		</header>
		<main>
			<noscript>
				<p class="warning">Sorry! This game won't work unless you turn on JavaScript.  
				Please change your browser or plugin settings to allow this script to run.</p>
			</noscript>
			<div id="board">
				<p id="choice">Choose: <span class="mark">X</span> or <span class="mark">O</span></p>
				<p id="chosen">You chose: <span class="mark">X</span> You get to make the first move.</p>
				<table>
					<tr id="row1"><td></td><td></td><td></td></tr>
					<tr id="row2"><td></td><td></td><td></td></tr>
					<tr id="row3"><td></td><td></td><td></td></tr>
				</table>
				<p class="right"><a id="reset">Play Again</a></p>
			</div>
			<div id="instructions">
				<h2>Instructions</h2>
				<ol>
					<li>Click or tab and select "X" or "O".</li>
					<li>Click or tab and select the empty square you want to use.</li>
					<li>Play until you or the computer win.</li>
				</ol>
			</div>http://www.w3schools.com/cssref/pr_border-color.asp
		</main>
		<footer><p>Made with jQuery.</p></footer>
		<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.3/jquery.min.js"></script>
		<script type="text/javascript">	
			(function($) {
				var pWinMess = "You won!";
				var cWinMess = "Sorry, you lost.";
				// Initialize player mark choice
				var pMark = cMark = "";
				
				var wins = [[1,2,3], [4,5,6], [7,8,9], [1,4,7], [2,5,8], 
							[3,6,9], [1,5,9], [3,5,7]];
				var board = Array(9);
				
				var $blocks = $("#board table td");
				
				// Make a function to initialize game once it's over
				function initBoard() {
					console.log("Initialize the board.");
					// Re-initializes values
					pMark = cMark = "";
					wins = [[1,2,3], [4,5,6], [7,8,9], [1,4,7], [2,5,8], 
							[3,6,9], [1,5,9], [3,5,7]];
					board = Array(9);
					// Get rid of any messages or warnings
					$("#board .warning, #board .message").remove();
					// Hide reset and chosen
					$("#chosen, a#reset").hide();
					// Bring back choice paragraph
					$('#choice').show();
					// Make choices active again
					$("#choice span.mark")
						.attr({
							role: "button",
							tabindex: function(i){ return i + 1}})
						.on("click keypress");
					// Remove board styles
					$("#board table, #board tr, #board td").removeAttr("style");
					// Empty out board cells
					$blocks.text("");
				}
				
				// Set up reset button
				// Give the reset button the ability to reset the game
				$("a#reset").on("click keypress", function(e) {
					if (e.type === "click" || (e.type === "keypress" 
								&& (e.which === 13 || e.which === 32))) {
						initBoard();
					}	
				});
				function findSpaces() {
					spaces = [];
					for (i = 0; i < board.length; i++) {
						if (typeof(board[i]) === "undefined") {
							spaces.push(i + 1);
						}
					}
					return spaces;
				}
				
				function endGame(mess, col) {
					var message = $("<p />", {"class" : "message"})
								.css("background-color", col).text(mess);
					$("#board table").after(message);
					$("#board .message").show();
					// Make the board inactive
					$blocks
						.off("click keypress")
						.removeAttr("tabindex")
						.css({"background-color" : "#ddd", color: "#aaa"});
					$("#board table tr#row2, #board table tr td:nth-child(2)").css("border-color", "#aaa");
					// Make the reset button visible and give it focus
					$("a#reset")
						.fadeIn(250)
						.attr({
							role: "button",
							tabindex: 1
						}).focus();
				}
				
				function win(marked, player) {
					console.log("Win function called!");
					// Set up response
					var mess = (player) ? pWinMess : cWinMess;
					// Mark the winning squares
					var col = (player) ? "green" : "blue";
					endGame(mess, col);
					// Mark the winning squares on the board
					for (i = 0; i < marked.length; i++) {
						$blocks.eq(marked[i] - 1)
							.css({
								color: "white",
								"background-color": col
							});
					}
				}
				
				function noWin() {
					console.log("No one won.");
					var mess = "This game was draw.  Good game!";
					endGame(mess, "grey");
				}
				
				// Function returns false if new mark won game
				// True if it hasn't
				function score(mark, place, player) {
					oMark = (mark === "X") ? "O" : "X";
					for (i = 0; i < wins.length; i++) {
						// Select only possible wins
						if (wins[i] !== null && wins[i].indexOf(place) !== -1) {
							// Start an array of places with marks
							markCount = [];
							for (j = 0; j < wins[i].length; j++) {
								if (board[wins[i][j] -1] === oMark) {
									wins[i] = null;
									break;
								} else if (board[wins[i][j] - 1] === mark) {
									// Add to the tally of marks in a win
									markCount.push(wins[i][j]);
								}
							}
							if (markCount.length === 3) {
								// There's been a win; stop playing
								win(markCount, player);
								console.log("That's a win!");
								return false;
							}
							if (markCount.length === 2) {
								
							}
						}
					}
					// No win yet; keep playing
					console.log("No win yet.");
					return true;
				}
				
				function move(spaces, mark) {
					oMark = (mark === "X") ? "O" : "X";
					
					var cwin;
					var owin;
					var space;
					// Find wins with one mark
					var owins = [];
					var cwins = [];
					winloop: for (i = 0; i < wins.length; i++) {
						if (wins[i] !== null) {
							markCount = omarkCount = 0;
							blockloop: for (j = 0; j < wins[i].length; j++) {
								if (board[wins[i][j] - 1] === undefined) {
									space = wins[i][j];
								}
								if (board[wins[i][j] - 1] === mark) {
									// First see if there's a winning move to make
									markCount++;
									if (markCount === 2) {
										cwin = wins[i];
										if (space === undefined) {
											space = wins[i][2];
										}
										break winloop;
									}
								} else if (board[wins[i][j] - 1] === oMark) {
									// Then see if there's an opposing win to block
									omarkCount++;
									if (omarkCount === 2) {
										console.log("Found move to block");
										owin = wins[i];
										if (space === undefined) {
											space = wins[i][2];
										}
										break winloop;
									} else if (omarkCount === 1) {
										owins.push(wins[i]);
									} else if (cmarkCount === 1) {
										cwins.push(wins[i]);
									}
								}
							}
							space = undefined;
						}
					}
					if (cwin !== undefined || owin !== undefined) {
						return space;
					} else {
						// Need to see if there's a space n such that it's in win a and win b 
						// Where both win a and win b have opposing marks
						mostWins = 0;
						var dspace;
						for (i = 0; i < spaces.length; i++) {
							winCount = 0;
							oWinsCount = 0;
							cWinsCount = 0;
							for (j = 0; j < wins.length; j++) {
								if (wins[j] !== null && wins[j].indexOf(spaces[i]) !== -1) {
									winCount++;
									if (owins.length > 1 && j < owins.length && owins[j].indexOf(spaces[i]) !== -1) {
										oWinsCount++;
										if (oWinsCount == 2) {
											// Block a player double win
											// Definitely take this space
											return spaces[i];
										}
									}
									if (cwins.length < 1 && j < cwins.length && cwins[j].indexOf(spaces[i]) !== -1) {
										cWinsCount++;
										if (cWinsCount === 2) {
											// Make a computer doubler win
											// Don't want to return value, in case a later space is a double win for the player 
											dspace = spaces[i];
										}
									}
								}
							}
							if (winCount > mostWins) {
								// Or just go with the most winning possibilities
								mostWins = winCount;
								space = spaces[i];
								console.log("Space " + space + " has " + mostWins + " possible wins.");
							}
						}
						space = (dspace) ? dspace : space;
						return space
					}
				}
				
				function turnOnBlocks(pMark){
					// Make board's squares clickable
					$blocks
						.attr({
							role: "button",
							tabindex: function(i){ return i + 1},
							id: function(i){ return i + 1 }
						})
						.on("click keypress", function(e) {
							if (e.type === "click" || (e.type === "keypress" 
									&& (e.which === 13 || e.which === 32) && $(this).text() === "")) {
								place = $(this).prop("tabindex");
								// Add player's mark to the visible board
								$(this).text(pMark);
								// Change the board array
								if (board[place - 1] === undefined) {
									board[place - 1] = pMark;
								} else {
									// Something has gone very wrong
									// Alert the player
									console.log("Board isn't blocking squares already chosen.");
								}
								// Test and change wins for win or finished
								if (score(pMark, place, true)) {
									// See where can move
									spaces = findSpaces();
									if (spaces.length > 0) {
										// Calculate best move
										cPlace = move(spaces, cMark);
										// Add computer's mark to the visible board
										$blocks.eq(cPlace - 1).text(cMark);
										// Change the board array
										if (board[cPlace - 1] === undefined) {
											board[cPlace - 1] = cMark;
										} else {
											// Something has gone very wrong
											console.log("Game tried to put computer mark where there was already a mark.");
										}
										// Test for winning move
										if (score(cMark, cPlace, false)) {
											// If no win, see if board is full after computer's move
											spaces = findSpaces();
											if (spaces.length === 0) {
												// If it is, end the game
												noWin();
											}
										} 	
									} else {
										// End of the game
										noWin();
									}
								}
								// Remove events
								$(this).off("click");
							} else if (e.type === "keypress") {
								// NOTE: which registered 0 for all arrow keys
								// Need to use keyCode for all of them
								if (e.keyCode === 37) {
									// If press left arrow
									// See if it's in the left most column
									if (wins[3].indexOf($(this).prop("tabindex")) === -1) {
										// If not, change focus to cell - 1	 
										$blocks.eq($(this).prop("tabindex") - 2).focus();
									}
								} else if (e.keyCode === 38) {
									// If press up arrow
									// See if it's in the top row
									if (wins[0].indexOf($(this).prop("tabindex")) === -1) {
										// If not, change focus to cell - 3
										$blocks.eq($(this).prop("tabindex") - 4).focus();
									}
								} else if (e.keyCode === 39) {
									// if press right arrow
									// See if we're in the right-most column
									if (wins[5].indexOf($(this).prop("tabindex")) === -1) {
										// If not, change focus to cell + 1
										$blocks.eq($(this).prop("tabindex")).focus();
									}
								} else if (e.keyCode === 40) {
									// If press down arrow
									// See if we're in the bottom column
									if (wins[2].indexOf($(this).prop("tabindex")) === -1) {
										// If not, change focus to cell + 3
										$blocks.eq($(this).prop("tabindex") + 2).focus();
									}
								} else if (!isNaN(String.fromCharCode(e.which))) {
									// The numbers are all keyCode 0
									// Need to use which for them
									var num = String.fromCharCode(e.which);
									if (num == 0) {
										num = 1;
									}
									// Move the focus to cell number 
									$blocks.eq(num -1).focus();
								}
							}
					});
				}
				
				// Give player ability to choose "X" or "O"
				// Make call external
				function chooseMark(e, pMark) {
					if (e.type === "click" || (e.type === "keypress" 
								&& (e.which === 13 || e.which === 32))) {
						cMark = (pMark === "X") ? "O" : "X";
						$("#chosen span.mark").html(pMark);
						$("#choice").fadeOut(250, function() {
							$("#chosen").fadeIn(250, function() {
								// Made this into a function for better readability
								turnOnBlocks(pMark);
							});
						});
					}
				}
				
				$("#choice span.mark")
					.attr({
						role: "button",
						tabindex: function(i){ return i + 1}})
					.on("click keypress", function(e) { chooseMark(e, $(e.target).text()); });
					
			}(jQuery));
		</script>
	</body>

</html>
